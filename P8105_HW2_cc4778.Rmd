---
title: "P8105_HW2_cc4778"
author: "Chee Kay Cheong"
output: github_document
---

```{r setup, echo = FALSE}
library(tidyverse)
library(readxl)
knitr::opts_chunk$set(collapse = TRUE, message = FALSE)
```

# Problem 1

```{r read clean}
subway_data = read_csv("./Data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>%
  janitor::clean_names() %>%
  select(line:entry, vending, ada) %>%
  mutate(entry = ifelse(entry == "YES", TRUE, FALSE))
```

I created a new dataset called '`subway_data`' that consists of 19 variables (columns) and 1868 observations (rows) which were extracted from the original csv datafile '`NYC_Transit_Subway_Entrance_And_Exit_Data.csv`'. So far, I have only cleaned the variable names by making them all lowercase, and I changed the variable type for `entry` from character to logical. 

The 19 variables in this dataset are:

* `line` (character)
* `station_name` (character)
* `station_latitude` (numeric)
* `station_longitude` (numeric)
* `route1` to `route7` (character)  <- 7 variables here
* `route8` to `route11` (numeric)  <- 4 variables here
* `entrance_type` (character)
* `entry` (logical)
* `vending` (character)
* `ada` (logical)

As we can see from the variables and their types, this dataset is not tidy enough. Not all "routes" are character vectors; some routes are numeric. Also, it seems like all the routes should be combined into one variable.

##### Questions

Q1: How many distinct stations are there?
  
A1: **465**
  
```{r stations}
subway_data %>% 
  select(station_name, line) %>% 
  distinct()
```

Q2: How many stations are ADA compliant?

A2: **84**
  
```{r ADA}
subway_data %>%
  filter(ada == TRUE) %>% 
  select(station_name, line) %>% 
  distinct()
```
  
Q3: What proportion of station entrances / exits without vending allow entrance?

A3: **37.7%** of station entrances are not vending allowed. 
  
```{r vending entrance}
subway_data %>% 
  filter(vending == "NO") %>%
  pull(entry) %>% 
  mean
```

*Reformat data so that route number and route name are distinct variables.*
```{r reformat}
subway_data %>% 
  pivot_longer(
    cols = starts_with("route"),
    names_to = "route_number",
    values_to = "route",
    values_transform = list(route = as.character)) %>% 
  filter(route == "A") %>% 
  select(station_name, line, route) %>% 
  distinct()

subway_data %>%
  pivot_longer(
    cols = starts_with("route"),
    names_to = "route_number",
    values_to = "route",
    values_transform = list(route = as.character)) %>% 
  filter(route == "A", ada == TRUE) %>% 
  select(station_name, line, route, ada) %>% 
  distinct()
```
Q4: How many distinct stations serve the A train?

A4: **60** 

Q5: Of the stations that serve the A train, how many are ADA compliant?

A5: **17**


# Problem 2

Read, clean, and organize Mr. Trash Wheel dataset:
```{r Mr. trash wheel}
mr_trash_wheel = 
  read_excel(
    "Data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
    sheet = "Mr. Trash Wheel", 
    na = "") %>% 
  janitor::clean_names() %>% 
  select(dumpster:homes_powered) %>% 
  drop_na() %>% 
  mutate(
    sports_balls = round(sports_balls),
    sports_balls = as.integer(sports_balls),
    trash_wheel = "Mr.")
```

Read, clean, and organize Professor Trash Wheel dataset:
```{r Professor trash wheel}
prof_trash_wheel = 
  read_excel(
    "Data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", 
    sheet = "Professor Trash Wheel", 
    na = "") %>% 
  janitor::clean_names() %>% 
  drop_na() %>% 
  mutate(
    sports_balls = round(sports_balls),
    sports_balls = as.integer(sports_balls),
    trash_wheel = "Professor")
```

Combine Mr. Trash Wheel and Professor Trash Wheel into one dataset:
```{r combine trash wheel}
trash_wheels = 
  full_join(mr_trash_wheel, prof_trash_wheel, by = "trash_wheel") %>% 
  janitor::clean_names()
```

```{r total trash weight, echo = FALSE}
total_trash_wt = sum(trash_wheels$weight_tons_y, na.rm = TRUE)
```

```{r balls 2020, echo = FALSE}
total_balls =
  trash_wheels %>% 
  filter(year_x == "2020") %>% 
  select(year_x, sports_balls_x, trash_wheel) %>% 
  pull(sports_balls_x) %>% 
  sum
```

I have added a new variable `trash_wheel` in both datasets before combining them, so that I know which data belongs to which dataset. After combining the two datasets into one dataset named `trash_wheels`, there are `r ncol(trash_wheels)` variables and `r nrow(trash_wheels)` observations. I used `full_join` to keep all the data in both datasets. In this new dataset `trash_wheels`, the original variable names have been modified such that an "x" has been added to the end of all variable names for `mr.trash_wheel`, whereas a "y" has been added to the end of all variable names for `prof_trash_wheel`. Since the `dumpster` variable in both datasets are not the same type (Mr. Trash Wheel is character, but Professor Trash Wheel is numeric), extra coding steps would be needed in order to merge the two datasets by `dumpster`, so I decided to merge them by `trash_wheel`. Hence, in the newly merged dataset, we can see that there are duplicated variable names (either followed by `_x` or `_y`), except for `trash_wheel`.

Professor Trash Wheel has collected a total of `r sum(total_trash_wt)` tons of trash, while Mr. Trash Wheel has collected `r sum(total_balls)` sports balls in 2020.


# Problem 3





