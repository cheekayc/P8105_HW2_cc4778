---
title: "P8105_HW2_cc4778"
author: "Chee Kay Cheong"
output: github_document
---

```{r setup, echo = FALSE}
library(tidyverse)
library(readxl)
knitr::opts_chunk$set(collapse = TRUE, message = FALSE)
```

# Problem 1

```{r read clean}
subway_data = read_csv("./Data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>%
  janitor::clean_names() %>%
  select(line:entry, vending, ada) %>%
  mutate(entry = ifelse(entry == "YES", TRUE, FALSE))
```

I created a new dataset called '`subway_data`' that consists of 19 variables (columns) and 1868 observations (rows) which were extracted from the original csv datafile '`NYC_Transit_Subway_Entrance_And_Exit_Data.csv`'. So far, I have only cleaned the variable names by making them all lowercase, and I changed the variable type for `entry` from character to logical. 

The 19 variables in this dataset are:

* `line` (character)
* `station_name` (character)
* `station_latitude` (numeric)
* `station_longitude` (numeric)
* `route1` to `route7` (character)  <- 7 variables here
* `route8` to `route11` (numeric)  <- 4 variables here
* `entrance_type` (character)
* `entry` (logical)
* `vending` (character)
* `ada` (logical)

As we can see from the variables and their types, this dataset is not tidy enough. Not all "routes" are character vectors; some routes are numeric. Also, it seems like all the routes should be combined into one variable.

##### Questions

Q1: How many distinct stations are there?
  
A1: **465**
  
```{r stations}
subway_data %>% 
  select(station_name, line) %>% 
  distinct()
```

Q2: How many stations are ADA compliant?

A2: **84**
  
```{r ADA}
subway_data %>%
  filter(ada == TRUE) %>% 
  select(station_name, line) %>% 
  distinct()
```
  
Q3: What proportion of station entrances / exits without vending allow entrance?

A3: **37.7%** of station entrances are not vending allowed. 
  
```{r vending entrance}
subway_data %>% 
  filter(vending == "NO") %>%
  pull(entry) %>% 
  mean
```

*Reformat data so that route number and route name are distinct variables.*
```{r reformat}
subway_data %>% 
  pivot_longer(
    cols = starts_with("route"),
    names_to = "route_number",
    values_to = "route",
    values_transform = list(route = as.character)) %>% 
  filter(route == "A") %>% 
  select(station_name, line, route) %>% 
  distinct()

subway_data %>%
  pivot_longer(
    cols = starts_with("route"),
    names_to = "route_number",
    values_to = "route",
    values_transform = list(route = as.character)) %>% 
  filter(route == "A", ada == TRUE) %>% 
  select(station_name, line, route, ada) %>% 
  distinct()
```
Q4: How many distinct stations serve the A train?

A4: **60** 

Q5: Of the stations that serve the A train, how many are ADA compliant?

A5: **17**


# Problem 2

Read, clean, and organize Mr. Trash Wheel dataset:
```{r Mr. trash wheel, message = FALSE}
mr_trash_wheel = 
  read_excel(
    "Data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
    sheet = "Mr. Trash Wheel", 
    na = "") %>% 
  janitor::clean_names() %>% 
  select(dumpster:homes_powered) %>% 
  drop_na() %>% 
  mutate(
    sports_balls = round(sports_balls),
    sports_balls = as.integer(sports_balls),
    trash_wheel = "Mr.",
    dumpster = as.numeric(dumpster))
```

Read, clean, and organize Professor Trash Wheel dataset:
```{r Professor trash wheel}
prof_trash_wheel = 
  read_excel(
    "Data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", 
    sheet = "Professor Trash Wheel", 
    na = "") %>% 
  janitor::clean_names() %>% 
  drop_na() %>% 
  mutate(
    sports_balls = round(sports_balls),
    sports_balls = as.integer(sports_balls),
    trash_wheel = "Professor")
```

Combine Mr. Trash Wheel and Professor Trash Wheel into one dataset:
```{r combine trash wheel}
trash_wheels = 
  bind_rows(mr_trash_wheel, prof_trash_wheel) %>% 
  janitor::clean_names()
```

```{r total trash weight, echo = FALSE}
total_trash_wt = 
  trash_wheels %>% 
  filter(trash_wheel == "Professor") %>% 
  pull(weight_tons) %>% 
  sum()
```

```{r balls 2020, echo = FALSE}
total_balls =
  trash_wheels %>% 
  filter(year == "2020", trash_wheel == "Mr.") %>% 
  pull(sports_balls) %>% 
  sum
```


Professor Trash Wheel has collected a total of `r sum(total_trash_wt)` tons of trash, while Mr. Trash Wheel has collected `r sum(total_balls)` sports balls in 2020.


# Problem 3

Read, clean, and organize the `pols-month.csv` dataset:
```{r pols month, message = FALSE}
pols = 
  read_csv("Data/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, into = c("year", "month", "day")) %>% 
  mutate(
    year = as.integer(year),
    month = month.name[as.numeric(month)],
    day = as.integer(day),
    president = ifelse(prez_dem == 1, "democratic", "republican")) %>% 
  select(-prez_dem, - prez_gop, -day)
```

Read, clean, and organize the `snp.csv` dataset:
```{r snp, message = FALSE}
snp = 
  read_csv("Data/snp.csv") %>% 
  janitor::clean_names() %>% 
  mutate(
    date = as.Date(date, format = "%m/%d/%y")) %>% 
  separate(date, into = c("year", "month", "day")) %>% 
  arrange(year, month, day) %>% 
  mutate(
    year = as.integer(year),
    month = month.name[as.numeric(month)],
    day = as.integer(day)) %>% 
  select(-day)
```

Read, clean, and organize the `unemployment.csv` dataset:
```{r unemployment, message = FALSE}
no_job = 
  read_csv("Data/unemployment.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "unemployment_rate") %>% 
  mutate(
    month = recode
    (month, 
      jan = 1, feb = 2, mar = 3, apr = 4, may = 5, jun = 6, jul = 7, aug = 8, sep = 9, oct = 10, nov = 11, dec = 12),
    month = month.name[as.numeric(month)])
```

Join the datasets by merging `snp` into `pols`, and merge `unemployment` into the result:
```{r merge}
pols_snp_unemp = 
 left_join(pols, snp, by = c("year", "month")) %>% 
 left_join(no_job, by = c("year", "month"))
```


